# 规则启动 <font color="red">重磅新功能！</font>

**自定义一些规则，每次RunAny启动会判断规则，规则成立就会自动启动软件**

**比如：判断电脑名 或 WiFi名是工作电脑，自动运行办公软件；**

**如果判断是家里的电脑，自动运行娱乐软件**

> 整合了我原来的RunAnyCtrl所有功能，同时增加了变量规则、启动RunAny菜单项、最小最大化启动等更多功能

---

## 一、准备插件：

1. **自动启动规则插件：（没有插件请点击`下载插件`下载）**

2. **插件准备好后重启RunAny**

![规则管理-插件启动](/assets/images/规则管理-插件启动.png)

**在RunAny图标右键托盘菜单中打开`插件管理`界面，设置 `RunCtrl_Common.ahk` 和  `RunCtrl_Network.ahk` 为 `自动启动`**

插件手动下载方式：

 - 下载`RunCtrl_Common.ahk` ：放在插件目录 RunPlugins
 - 下载`RunCtrl_Network.ahk`：放在插件目录 RunPlugins
   - 该插件因为是网络接口需要依赖`JSON.ahk`，`JSON.ahk`需要放在  RunPlugins\Lib  目录里


## 二、创建使用规则组：

![规则管理-使用演示](/assets/images/规则管理-使用演示.gif)

1. 在任务栏的`Ra图标`右键菜单中打开`启动管理`
2. 先点击`规则管理`按钮，再点击`添加最新默认规则`
   - `RunCtrl_Common.ahk` 和  `RunCtrl_Network.ahk` 如果没有启动，只会添加默认的变量规则
3. 然后返回界面点击`添加规则组`按键，填写一个新规则组名
   - 如果默认勾选“启用规则组”且下面没有添加任何规则，那每次RunAny启动都会直接运行启动项
   - “与”代表满足所有规则才能运行启动应用，“或”代表满足其中一项就会自动启动应用
   - 循环次数+间隔时间可以自动多次验证规则多次启动应用，直到达到最大次数
4. 点击`增加规则`按钮，增加一个规则到规则组
   - 规则分为 **菜单变量规则** 和 **插件函数规则**，**插件函数规则**又分为：`传参规则` 和 `无参规则`
     - **菜单变量规则** 和 `无参规则`：是返回具体的结果值，然后可以在界面中选中 等于、不等于、大于、大于等于、小于、小于等于 的运算来判断规则是否成立
     - `有参规则`：会把条件值传递给函数，函数只能直接返回 规则成立（真）或 规则不成立（假）
   - 有中断标记的规则：不满足此规则条件就中断整个规则循环（建议排在其他规则前面）
5. 最后再点击`添加启动应用`
   - 在对应的规则组内添加要启动的`菜单项`或`全路径程序`，路径支持RunAny菜单变量
   - 选择 管理员、最小化、最大化、隐藏、置顶 运行方式（部分软件无法最大化和隐藏）
   - 目前菜单2的菜单项需要手动填写（去掉热键后），后续版本会做支持
6. 这样就可以自动根据不同规则判断来运行不同的程序了
   - 选中规则组点击`启动`按钮可以验证并启动规则组
   - 多选右边应用点击`启动`可以跳过规则直接启动



---

## 三、规则自定义：

### 菜单变量规则

- 说明见网页：[内置系统环境变量和RunAny变量列表](/article/built-in-variables.md)
  - Windows系统环境变量 需要添加到 RA设置 的 `菜单变量` 里面才可以用于规则
  - 所有 RunAny变量 和 Autohotkey变量 可以直接新增到规则里使用

### RunAny.ahk 自身规则函数（不需要下载插件）
| 规则名       | 规则函数           | 规则说明                                                     |
| ------------ | ------------------ | ------------------------------------------------------------ |
| 开机时长(秒) | rule_boot_time     | 返回：系统已经运行的时长，如 60.5 表示系统运行了60.5秒       |
| 电脑机型     | rule_chassis_types | 返回：台式机3、笔记本10 等机型：https://docs.microsoft.com/zh-cn/windows/win32/cimwin32prov/win32-systemenclosure |
| 联网状态     | rule_check_network | 参数可传可不传，不传默认判断http://www.baidu.com是否正常，返回：1代表联网 0代表断网 |
| 运行状态     | rule_check_is_run  | 必须传递参数：如qq.exe，返回：1代表正在运行 0代表未运行      |


### RunCtrl_Common.ahk插件 公共规则函数库

| 规则名             | 规则函数            | 规则说明                                                     |
| ------------------ | ------------------- | ------------------------------------------------------------ |
| WiFi名             | rule_wifi_silence   | 必须传递参数：Wifi名，判断与当前系统连接的Wifi名是否相同     |
| 内网IP             | rule_ip_internal    | 返回：本地IP地址                                             |
| 最近打开文件(今天) | rule_run_today_file | 必须传递参数：文件名，判断规则最后运行时间和今天最近打开文件列表中是否有该文件 |
| 运行过(今天)       | rule_run_today      | 必须传递参数：程序名，判断规则最后运行时间和当前系统今天是否运行过此程序 |
| 验证ini配置的值    | rule_check_ini      | 必须传递参数：ini文件路径、段落名、ini键、ini键值，判断配置文件值是否与参数相同，返回：1相同 0不同 |
| 验证注册表的值     | rule_check_regedit  | 必须传递参数：注册表路径、注册表键、注册表键值，判断注册表值是否与参数相同，返回：1相同 0不同 |

### RunCtrl_Network.ahk插件 网络规则函数库

| 规则名   | 规则函数            |
| -------- | ------------------- |
| 城市     | rule_ip_city        |
| 外网IP   | rule_ip_external    |
| 国家     | rule_ip_country     |
| 国家代码 | rule_ip_countryCode |
| 省       | rule_ip_region      |
| 省缩写   | rule_ip_regionName  |
| 纬度     | rule_ip_lat         |
| 经度     | rule_ip_lon         |
| 时区     | rule_ip_timezone    |
| 运营商   | rule_ip_isp         |

规则说明：

打开 http://ip-api.com/json 查看示例，可以复制到 https://www.json.cn 查看
